对于非技术从业者来说，`写代码`似乎是一件很神秘的事情。电影里总是有这样的桥段：程序员噼里啪啦敲一通键盘，屏幕上就飞快滚动着一堆让人看不懂的字符，最后计算机屏幕`嘭`地一声，奇迹就发生了。

但实际上，写代码就是用特定的语言，给计算机下达指令，让它按照你的意愿去工作。这就像我们用自然语言与人交流一样，只不过计算机的语言更加简洁、精确。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38bd662843a24c2ab9bbf1b0098c3fac~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=1090&h=1748&s=189690&e=png&a=1&b=fafafa)

在 Coze 工作流中，代码节点为你打开了一扇与机器对话的大门。通过在节点中编写代码，你可以对接收到的数据进行任意加工处理，实现各种强大的功能。就像一位厨师利用食材大展身手，最后端出一道道佳肴。

代码节点**支持主流的编程语言，比如 JavaScript、Python 等**。无论你是前端、后端，还是人工智能方向的开发者，都可以使用自己擅长的语言。**Coze 还贴心地内置了一个网页版的集成开发环境（IDE），你不需要在本地搭建繁琐的开发环境**，就可以直接在浏览器里编写和调试代码，非常方便。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5479290db97843668f71ccdf578ff08c~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=4408&h=2782&s=477765&e=png&a=1&b=1e1e1e)

这里就简单解释一下什么是**集成开发环境（IDE）**，IDE 是一种集成了多种开发工具的软件，可以帮助开发者提高编程效率。比如代码编辑器、编译器、调试器等，都可以在 IDE 中找到。IDE 还提供了代码补全、错误提示等功能，让开发者更加高效地编写代码。而在 Coze 中，这个网页版 IDE 的作用就是帮助你在代码节点中编写和调试代码，让你更加轻松地处理数据。

那么，具体要如何使用代码节点呢？又有哪些使用技巧和应用场景呢？让我们继续往下看。

## 使用流程

学会使用代码节点，并不需要你成为一名编程高手。即使你从未写过代码，跟着 Coze 工作流的引导，也可以轻松上手。下面我们就来看看，如何在工作流中使用代码节点。

**1\. 配置节点的输入参数**

在代码节点上，我们首先需要配置节点的输入参数。输入参数就是传递给代码的数据，可以是来自上一个节点的输出，也可以是在节点内部定义的静态变量。所以我们**首先要好好想想这个代码节点具体要解决些什么能让其他节点都不能解决的问题，不是所有的问题都需要代码节点来解决**。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b16fa64c65b740ee96227b1081f69953~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=1130&h=1758&s=236194&e=png&a=1&b=fafafa)

设置输入参数就像是给函数传入自变量，让代码知道要对什么数据进行处理。比如，如果上一个节点输出的是一个用户信息的 `Object` 对象，我们可以在代码节点里把它解构成 `name`、`age` 等属性，方便后续使用：

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b284e30ffdf430ca8045e1555cebbb8~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=3790&h=2300&s=632594&e=png&a=1&b=f1f2f4)

**2\. 在 IDE 中编写处理逻辑**

接下来就是激动人心的编码环节了。点击`在 IDE 中编辑`，Coze 内置的网页版开发环境就会弹出。如果你曾经使用过 `VS Code` 等编辑器，会感到有点熟悉。左边是代码编辑区，而右上角有个`测试代码`按钮，点击就可以在右边调出输入输出的调试区：

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b82392064784fa5ae2e053f3ebedd87~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=3072&h=2782&s=286141&e=png&a=1&b=1e1e1e)

在编辑区，你可以尽情发挥创意，用代码处理传入的数据。比如对字符串进行格式化、对数字进行计算、对数组进行遍历等等。**IDE 还提供了代码补全、错误提示等辅助功能**，即使你不太熟悉编程语言，也能很快上手。

如果**感到思路卡壳，还可以使用 IDE 的 AI 助手功能，描述你的需求，让 AI 帮你自动生成代码片段**。这就像是有一个随时待命的编程小助手，随时帮你解决你的问题。

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eeafe4fb9da24c83aab99557f184a6a4~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=2076&h=2818&s=286826&e=png&a=1&b=1e1e1e)

具体的实际用法我会在文章的下面部分给出。

**3\. 设置输出参数与格式**

处理完数据后，我们需要将结果输出，传递给下一个节点。在代码最后，将要输出的变量用 `return` 语句返回即可。你会发现，**其实代码中`return`给出的数据结构和内容是完全匹配上节点模块的输出内容的，而且不只是输出参数的名称要一样，连对应的数据类型也要一样，这样整个代码才不会报错**。这里我利用`Python`代码来举些例子说明：

1. 比如我在代码节点中设置了输出参数为`result`，那么在代码中就要返回一个`result`的变量，而且这个`result`变量的数据类型要和输出参数的数据类型一致，比如我设置了输出参数的数据类型为`String`，那么我在代码中返回的`result`变量也要是一个`String`对象： ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a32ff7ee5e654d53adaafa2fca3560dd~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=2476&h=1602&s=271703&e=png&a=1&b=1e1e1e)
2. 如果变量名称或者对应的数据类型不一致，那么代码节点就会报错，比如我在代码中返回的是一个`Integer`对象，但是输出参数的数据类型是`Object`，那么代码节点就会报错： ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ebff7d3574d40a6824b59aaa11a31c4~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=2914&h=1608&s=321297&e=png&a=1&b=1e1e1e)
3. 这里其实不只是输出变量有这个限制，输入参数也是一样的，比如我在代码节点中设置了输入参数为`input`，那么在代码中就要接收一个`input`的变量，不能无中生有接收一个不存在的输入参数作为变量，否则代码节点也会报错： ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/57ba6efc8c8e4b618d8d3e39b9650d74~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=3386&h=2200&s=490546&e=png&a=1&b=1e1e1e)

**4\. 连接其他节点，组成完整的工作流**

处理完的数据，我们一般会连接到其他类型的节点，比如用文本处理节点做进一步的语言优化，或者用 HTTP 请求节点将结果发送到外部 API 等。将各种节点连接组合，就形成了一个完整的工作流。数据在节点间流转，经过一系列加工，最终输出我们想要的结果。

## 使用技巧

代码节点为工作流注入了无限可能，但如何才能用最少的代码，实现最强大的功能呢？这里有一些使用代码节点的技巧，可以帮助你事半功倍。其实以下的使用技巧除了是平台层面的技巧，也是一些有关编程的最佳实践。

#### 1\. 利用代码提示与 AI 辅助编程提升开发效率

1. 首先，在 IDE 底部单击`尝试 AI`，输入清晰明确的自然语言设定代码逻辑，让 AI 能够准确理解你的需求。例如，如果你需要实现一个数据排序的功能，可以详细描述数据的类型、排序的规则等： ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b55ad30edce04b38acef3318e726b022~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=1896&h=908&s=255775&e=png&a=1&b=2e2c2a)

2. **选中代码片段，再快捷键唤起 AI，并输入自然语言让其帮助修改这个选中部分的代码**。在这个过程中，要准确指出需要修改的部分和期望达到的效果。这意味着什么呢？假设你完全不懂代码的情况下，你设置可以直接基于代码节点初始给你的示例代码，然后全部选中，唤起 AI，输入你的需求，然后 AI 会帮你修改这段代码，这样你可以不用懂代码，也可以完成你一些简单的需求。比如以下例子，假设我这里有一个输入变量 `input`，数据类型是`String`，我想要将这个变量的值转换为大写，我可以直接选中这段代码，唤起 AI，输入`将 input 变量的值转换为大写`，然后 AI 会帮你修改这段代码： ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/597a69185cba40f8acceff9a8318570f~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=2862&h=1384&s=325452&e=png&a=1&b=1e1e1e)

   > 这里有个小技巧，在你需要 AI 帮你修改整份代码的时候，你可以先声明一下输入和输出参数具体有些什么，然后再让 AI 帮你修改代码。这样 AI 给你的代码会更符合你的需求而且成功率更高。

3. 为了让 AI 生成更符合需求的代码，你提供的描述越详细、越具体越好。不仅说明功能需求，还可以提及性能优化、代码风格等方面的要求。就如你像上面例子一样需要对一个数组进行排序，可以说明是升序还是降序，是按照数字大小排序还是按照字母顺序排序等。

4. 生成完代码，当然需要通过调试功能来验证代码的正确性。在代码节点中，你可以通过`测试代码`按钮来查看代码的运行结果，以确保代码逻辑的正确性。比如我们接着第二点的例子，我们可以点击右上角的`测试代码`按钮，然后测试区域右上角的`自动生成`按钮，它会直接帮助生成这个代码节点输入参数的测试用例，然后你可以点击`运行`按钮，查看代码的运行结果： ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52fdb41f74064c5281d3f03cf6ddb4cb~tplv-k3u1fbpfcp-jj-mark:1600:0:0:0:q75.png#?w=2894&h=2036&s=451019&e=png&a=1&b=1e1e1e)

通过合理运用这些技巧，可以大大提高代码生成的效率和质量，节省开发时间。当然，如果自己是技术小白，实在不会如何开始写代码的话，你可以直接多参考 Coze 平台上工作流商店里面一些工作流使用到代码节点的案例，可以尝试去理解这些代码节点的逻辑，然后再根据自己的需求进行修改。

#### 2\. 充分利用内置的第三方库简化代码

为了让开发者把注意力集中在核心逻辑上，Coze 在代码节点环境中内置了常用的第三方库，比如在编程语言`Javascript`中，自带支持`Typescript`的代码编写，也有内置用于处理时间的 `Day.js`，用于数据处理的 `Lodash` 等。

在编程语言`Python`中，目前内置了`requests_async`和`numpy`的第三方库。`requests_async` 依赖库与 `requests` 类似，但需要 `await` 关键字来调用，适用于异步请求。`numpy` 是一个用于数值计算的库，提供了大量的数学函数和矩阵运算功能。

基于内置的这些库，我们可以多使用他们，从而简化我们的代码实现逻辑。比如要对一个数组进行去重，如果自己写逻辑，可能要十几行代码。但使用 `Lodash`，只需一行 `_.uniq(array)` 就搞定了。

#### 3\. 灵活使用平台提供的 API 如发送请求等

Coze 平台为代码节点提供了一些特殊的 API，可以让节点与外部世界互动。比如`Javascript`语言中发送 HTTP 请求的 `fetch` 函数，可以让你在代码节点中访问任意的网络资源。`Python`语言中的 `requests_async` 库，也可以让你发送 HTTP 请求，获取网络数据。

这样一来，你就可以在代码节点中实现更多的功能，比如获取远程数据、调用外部服务等。甚至说限于代码节点的局限性，我们可以把更加复杂的逻辑放到外部的服务中，然后通过代码节点来调用这些服务，这样可以让我们的代码节点更加简洁，逻辑更加清晰。不过这就前提需要你对技术开发和运维有一定的了解了。

## 应用场景

代码节点就像是一把瑞士军刀，有了它，你可以在工作流中实现各种强大的功能。下面我们就来看看一些典型的应用场景，**这块可能真正的技术术语比较多，如果你是技术小白的话，大概有个印象就好了，不需要深究，这些场景其实也是真正程序员的工作日常比较简单的部分了**。

#### 1\. 格式转换：如 JSON 数据处理

在实际开发中，我们经常需要处理各种格式的数据，尤其是 JSON。代码节点可以帮我们轻松地在不同格式之间转换。比如将一个 JSON 字符串解析为 JavaScript 对象：

```javascript
const jsonString = '{"name": "Tom"， "age": 18}';
const jsonObject = JSON.parse(jsonString);
console.log(jsonObject.name); // 输出 "Tom"

async function main({ params }: Args): Promise<Output> {
  const jsonString = params.jsonString;
  const jsonObject = JSON.parse(jsonString);

  const ret = {
    parsedObject: jsonObject,
    stringifiedObject: JSON.stringify(jsonObject),
  };

  return ret;
}
```

或者反过来，将一个对象序列化为 JSON 字符串：

```javascript
async function main({ params }: Args): Promise<Output> {
  const jsonObject = params.jsonObject;
  const jsonString = JSON.stringify(jsonObject);

  const ret = {
    parsedObject: JSON.parse(jsonString),
    stringifiedObject: jsonString,
  };

  return ret;
}
```

通过简单的 `JSON.parse` 和 `JSON.stringify`，我们就可以在字符串和对象之间自由转换，方便后续的处理。

#### 2\. 数据抽取：如正则匹配、XPath 解析等

很多时候，我们拿到的数据是“原始”的，需要从中提取出我们感兴趣的部分。比如从一段 HTML 中提取所有的链接：

```javascript
async function main({ params }: Args): Promise<Output> {
  const html = params.html;
  const linkRegex = /<a\s+href="(.*?)">(.*?)<\/a>/g;
  const links = [];
  let match;
  while ((match = linkRegex.exec(html))) {
    links.push({ url: match[1], text: match[2] });
  }

  const ret = {
    extractedLinks: links,
  };

  return ret;
}
```

这里我们使用正则表达式，匹配 `<a>` 标签中的 `href` 属性和文本内容，然后将结果存入一个数组。正则虽然写起来有些复杂，但是它的匹配能力非常强大。

如果你对正则不太熟悉，也可以使用 `XPath` 等其他方式来提取数据。**总之利用代码节点，我们可以将“乱七八糟”的原始数据，转换为结构化的、易于处理的形式**。

#### 3\. 实现复杂的条件判断与业务逻辑

某些场景下，我们需要根据复杂的条件，来决定后续的流程走向。比如根据用户的年龄、性别、地区等信息，给出个性化的推荐。如果用一般的条件节点，可能需要配置很多分支，逻辑会变得难以维护。

这时，我们可以在代码节点中用 `if-else` 来实现复杂的条件判断：

```javascript
async function main({ params }: Args): Promise<Output> {
  const user = params.user;

  let recommendation;
  if (user.age < 18) {
    recommendation = "cartoon";
  } else if (user.age >= 18 && user.age < 35) {
    if (user.gender === "male") {
      recommendation = "action movie";
    } else {
      recommendation = "romance movie";
    }
  } else if (user.region === "China") {
    recommendation = "Chinese movie";
  } else {
    recommendation = "Hollywood movie";
  }

  const ret = {
    userRecommendation: recommendation,
  };

  return ret;
}
```

通过代码，我们可以轻松地组合多个条件，实现任意复杂的判断逻辑，然后再给后续的选择器节点来做一些简单的流程判断。

#### 4\. 接入外部 API 扩展工作流功能

Coze 平台提供的节点类型虽然丰富，但难免有些场景无法覆盖。这时，我们可以利用代码节点，调用外部的 API，来扩展工作流的功能。

例如，我们有一个现成的第三方翻译工具 API，我们可以调用它，实现多语言的内容生成：

```javascript
async function main({ params }: Args): Promise<Output> {
  const apiKey = params.apiKey;
  const text = params.text;
  const targetLanguage = params.targetLanguage;

  const response = await fetch(
    `https://api.example.com/translate?key=${apiKey}&text=${text}&target=${targetLanguage}`
  );
  const result = await response.json();

  const ret = {
    translatedText: result.translatedText,
  };

  return ret;
}
```

通过发送 HTTP 请求，我们可以将文本发送给翻译 API，然后拿到翻译后的结果，实现不同语言之间的转换。类似地，我们还可以接入各种三方服务，如地图、支付、社交等，让工作流变得更加强大。

这种“**一问多答**”的机制，可以让我们的智能问答系统变得更加灵活和全面。而**代码节点在其中扮演了“中控”的角色，通过调用不同节点的 API 并协调它们的结果，来选出最佳的答案**。

代码节点与其他节点配合，可以让整个工作流的能力实现 1+1>2 的效果，为各种业务场景赋能。

## 工作流代码节点和插件的区别

在这里，可能大家会有点疑惑，怎么代码节点和插件看起来这么像呢？其实，它们确实有很多相似之处，但也有一些区别，这里我来按我理解的方式给大家解释一下。

#### 功能范围：灵活性 vs 扩展性

**代码节点：工作流内部的`多面手`**

代码节点主要用于在工作流中执行特定的代码逻辑，如数据处理、条件判断、循环等。它们就像是工作流内部的`多面手`，通过编写代码，可以灵活地控制工作流的执行逻辑和数据流转。

举个例子，假设在一个数据处理的工作流中，你需要对输入的数据进行过滤、转换和计算。这时，你可以使用代码节点编写自定义的 Python 或 JavaScript 代码，来实现这些数据处理的逻辑。代码节点给了你充分的控制力，可以根据需求来编写各种复杂的算法和逻辑。

**插件：功能扩展的`百宝箱`**

插件则提供了独立的、可复用的功能模块，用于扩展主程序的功能。它们就像是一个`百宝箱`，里面装满了各种实用的工具和服务。

例如，当你需要在 Bot 中添加搜索功能时，可以直接使用现成的搜索插件，如 Bing 搜索或 Google 搜索。这些插件已经封装了搜索引擎的 API 和相关逻辑，你只需要简单地配置和调用，就可以实现强大的搜索功能，而无需自己编写搜索引擎的代码。

#### 使用场景：定制化 vs 即插即用

**代码节点：工作流设计的`定制大师`**

代码节点主要在工作流设计时使用，用于定义工作流的执行逻辑和数据流转。它们通常由工作流设计者或开发人员使用，以控制工作流的行为。

当工作流需要执行高度定制化的逻辑，或者需要处理复杂的数据结构时，代码节点就派上了用场。通过编写代码，你可以精细地控制每一步的执行过程，并根据需求来调整和优化。

**插件：Bot 和工作流的`即插即用`利器**

插件则可以在 Bot 内直接使用，也可以在工作流中作为节点使用。它们提供了预定义的功能，用户可以根据需求选择和配置合适的插件，实现`即插即用`。

比如，当你需要为 Bot 添加多语言支持时，可以使用现成的翻译插件，如 Google 翻译或百度翻译。通过简单的配置，插件就可以自动将用户的输入翻译成指定的语言，并返回翻译结果。这样，你就可以快速地为 Bot 扩展多语言功能，而无需从头开发翻译模块。

#### 灵活性和可复用性：定制化 vs 标准化

**代码节点：灵活但难以复用**

代码节点提供了高度的灵活性，允许用户编写自定义代码来实现特定的逻辑。你可以根据工作流的需求，来编写各种复杂的算法和数据处理逻辑。

然而，这种灵活性也带来了一定的局限性。由于代码节点通常与特定的工作流绑定，因此很难将其复用到其他工作流或场景中。如果其他工作流需要类似的功能，你可能需要重新编写代码，或者进行大量的修改和适配。

**插件：标准化接口，高度可复用**

插件则具有很高的可复用性。由于插件提供了标准化的接口和功能，因此可以在多个 Bot 或工作流中使用，而无需重复编写代码。

例如，你开发了一个自定义的天气查询插件，可以根据用户输入的城市名称，返回该城市的天气信息。这个插件可以被多个 Bot 或工作流使用，只需要简单地配置和调用插件的接口即可。这种标准化的设计使得插件的复用性大大提高，降低了开发和维护的成本。

## 总结

在本文中，我们深入探讨了代码节点在 Coze 工作流中的重要作用。**代码节点**犹如魔法师手中的法杖，使得开发者能够灵活运用编程语言来扩展和增强工作流的功能。无论是处理复杂的数据逻辑、调用外部 API、实现格式转换，还是执行复杂的条件判断，代码节点都展现出了强大的能力。

我们还介绍了**使用代码节点的具体流程和技巧**，包括如何配置输入输出参数、在 IDE 中编写代码、以及如何利用 AI 辅助编程提高效率。此外，通过内置的第三方库和平台提供的 API，开发者可以更加便捷地实现各类功能，节省开发时间和精力。

最后，我们分析了**代码节点和插件之间的区别**。代码节点提供了高度的灵活性，适用于需要定制化逻辑的场景；而插件则以标准化接口为特色，具备高度的可复用性，适合即插即用的功能扩展。

**在 Coze 工作流中，代码节点是不可或缺的工具，为开发者提供了无限的可能性**。不论你是资深程序员还是编程初学者，掌握代码节点的使用方法，都将帮助你更好地实现业务目标，提高开发效率。